# CVE Query Script

This script fetches Common Vulnerabilities and Exposures (CVEs) from the [National Vulnerability Database (NVD)](https://nvd.nist.gov/) based on keywords specified in a CSV file. It supports local execution and deployment as an AWS Lambda function. The results can be emailed to a specified recipient when deployed in AWS Lambda.

## Features

- Fetch CVEs from the NVD API based on keywords.
- Specify a date range for CVE searches.
- For AWS Cloud deployment, supports send results using Amazon SES (AWS Lambda only).

## Requirements

- Python 3.7+
- Libraries: `requests`, `json`, `csv`, `datetime`, `yaml`, `pytz`, `os`, `boto3`, `email.mime.multipart`, `email.mime.base`, `email`, `email.mime.text`, `time`, `re`
- AWS account with access to SES and S3 services
- NVD API KEY (Request [here](https://nvd.nist.gov/developers/request-an-api-key)) - You can use this script without a api key, but with a request limit

## Setup

### Local Environment

1. Clone the repository and navigate to the project directory:
    ```sh
    git clone https://github.com/your-repo/cve-query.git
    cd cve-query
    ```

2. Install the required Python libraries listed on requirements section

3. Create a CSV file named `input.csv` with a `keyword` column listing the keywords to search for CVEs:
    ```csv
    keyword
    keyword1
    keyword2
    keyword3
    ```

4. Update the script configuration variables as needed

5. Run the script:
    ```sh
    python cve_query.py
    ```

### AWS Lambda Deployment

1. Create an S3 bucket and upload your `input.csv` file to it.

2. Update the S3 configuration in the script:
    ```python
    s3_bucket = 'your_s3_bucket_name'
    s3_input_csv_key = 'input.csv'
    cloud_deploy = True
    ```

3. Package your code and dependencies as a Lambda layer:
    - Install dependencies in a local directory:
        ```sh
        mkdir -p python
        pip install requests pytz -t python/
        zip -r layer.zip python
        ```
    - Upload the layer to AWS Lambda.

4. Create a new Lambda function, upload Lambda Layers and put the script code on it.

5. Configure the necessary environment variables and permissions for SES and S3 access.

6. Remeber that the Lambda function role will need access to AWS S3 bucket and AWS SES

## Usage

### Local Execution

Run the script to fetch CVEs based on keywords from `input.csv` and save the results in JSON files.

### AWS Lambda

Invoke the Lambda function manually or set up a scheduled event to run the function periodically. The function will download the `input.csv` from S3, fetch CVEs, save the results in JSON files, and email the results if there are any findings.

## License

This project is licensed under the MIT License. 

This script uses the NVD API but is not endorsed or certified by the [NVD](https://nvd.nist.gov/developers/terms-of-use)

## Contributing

Contributions are welcome! Please fork the repository and submit a pull request.